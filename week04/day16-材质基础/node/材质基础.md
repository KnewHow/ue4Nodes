# Day16-材质基础

## 1 UV

https://www.zhihu.com/question/31064727

将一个立体的图形展成一个平面图形的过程，叫做展UV。

原始图形：

![image-20200525090840897](../images/image-20200525090840897.png)

展开后的UV:

![image-20200525090905480](../images/image-20200525090905480.png)



## 2 使用程序网格模拟模型

### 2.1 顶点数

![image-20200525091945539](../images/image-20200525091945539.png)



### 2.2 三角面

使用三角形绘制图形，一个正方形需要两个三角面拼接而成。在UE4中，大多使用三角面来渲染物体，效率较高。

![image-20200525092547722](../images/image-20200525092547722.png)

### 2.3 法线和UV

![image-20200525092956470](../images/image-20200525092956470.png)



### 2.4 顶点颜色

![image-20200525093056220](../images/image-20200525093056220.png)

### 2.5 法线（Normals）和、切线（Tangents）和副法线（Binormals）

![image-20200525093306931](../images/image-20200525093306931.png)



## 3 着色器

先由顶点着色器做初步渲染，然后在进一步渲染：

![image-20200525094018915](../images/image-20200525094018915.png)

### 3.1 顶点着色器在材质中的体现

![image-20200525094118799](../images/image-20200525094118799.png)



### 3.2 Time

![image-20200525094257177](../images/image-20200525094257177.png)

周期：

![image-20200525094649869](../images/image-20200525094649869.png)

### 3.3 顶点颜色

![image-20200525094907168](../images/image-20200525094907168.png)

​	预览效果：

![image-20200525095058655](../images/image-20200525095058655.png)



### 3.4 视口数据（ViewProperty）

![image-20200525100258532](../images/image-20200525100258532.png)

里面有很多和视口相关的功能：

![image-20200525100333842](../images/image-20200525100333842.png)



![image-20200525095252074](../images/image-20200525095252074.png)



### 3.5 材质分类

![image-20200525100410705](../images/image-20200525100410705.png)

PBR：根据物理定律渲染

NPBR: 不根据物理渲染

### 3.6 Actor 世界坐标

将该材质给一个 Actor,则此方法就会返回该材质在游戏世界中的坐标。

![image-20200525101009703](../images/image-20200525101009703.png)

### 3.7 对象坐标(Object Postion)

![image-20200525101527380](../images/image-20200525101527380.png)

### 3.8 Camera Position

![image-20200525101616546](../images/image-20200525101616546.png)

### 3.9 Object Radius

![image-20200525101809133](../images/image-20200525101809133.png)

### 3.10 Absolute World Position

![image-20200525102100910](../images/image-20200525102100910.png)

### 3.11PixeNormalWS

WS(World Special)

![image-20200525102459258](../images/image-20200525102459258.png)

### 3.12 VertexNormalWS（顶点坐标世界法线）

![image-20200525102927597](../images/image-20200525102927597.png)

### 3.13 贴图映射

![image-20200525103332486](../images/image-20200525103332486.png)

### 3.14 Texture Object 和 Texture

![image-20200525103903862](../images/image-20200525103903862.png)	

### 3.15 TexCoord

理解连接：https://www.dingshukai.com/blog/ue4-material-texcoord-texturecoordinate.html

### 3.16 Panner（平移）

![image-20200525104123919](../images/image-20200525104123919.png)

### 3.17 Rotator （旋转）

![image-20200525104445007](../images/image-20200525104445007.png)

### 3.18 Depth Fade

![image-20200525111012844](../images/image-20200525111012844.png)



### 3.19 Scene Depth（场景深度）和 Pixe Depth（像素深度）

![image-20200525111721749](../images/image-20200525111721749.png)



### 3.20 Append

将一个向量新加一个维度：

![image-20200525112226071](../images/image-20200525112226071.png)

### 3.21 小数四舍五入

![image-20200525113233831](../images/image-20200525113233831.png)

### 3.22 ComponentMask（向量拆解）

在材质中是 Mask,将一个向量拆解到某个维度。

### 3.23 Clamp

限制最大值和最小值

![image-20200525113536494](../images/image-20200525113536494.png)

### 3.24 Saturate

只能从0~1

![image-20200525113753239](../images/image-20200525113753239.png)

### 3.25 Sign 

判断数字符号

输入:

* 负数 --> -1
* 0 --> 0
* 正数 --> 1



![image-20200525114019472](../images/image-20200525114019472.png)

### 3.26 向量叉乘

参考：[https://zh.wikipedia.org/wiki/%E5%8F%89%E7%A7%AF](https://zh.wikipedia.org/wiki/叉积)

![image-20200525114241625](../images/image-20200525114241625.png)

### 3.27 向量点乘

[https://zh.wikipedia.org/wiki/%E7%82%B9%E7%A7%AF](https://zh.wikipedia.org/wiki/点积)

![image-20200525114710938](../images/image-20200525114710938.png)

### 3.28 DeSaturation（去饱和度）

![image-20200525115042257](../images/image-20200525115042257.png)

### 3.29 将材质属性拆分

![image-20200525115209172](../images/image-20200525115209172.png)

### 3.30 质量选择

![image-20200525134745080](../images/image-20200525134745080.png)

### 3.31 Custom

自定义节点，需要对着色器底层有了解，然后自己写控件。

![image-20200525135029086](../images/image-20200525135029086.png)

### 3.32 Static Bool 和 Switch

![image-20200525135148843](../images/image-20200525135148843.png)

### 3.30 简单的数学表达式

![image-20200525112559933](../images/image-20200525112559933.png)



## 4 材质和材质实例

### 4.1 材质实例创建

![image-20200525135510578](../images/image-20200525135510578.png)

### 4.2 材质实例面板

![image-20200525135853387](../images/image-20200525135853387.png)



材质实例可以让逻辑类似的材质代码可以复用。材质可以当模板，材质的实例依然可以当模板。每个材质在渲染的都需要被显卡调用一次，但是如果是材质实例，同一个模板的材质会被一起渲染。

材质的静态的，当游戏运行的时候，就无法修改的，但是动态材质(Dynamic Material) 可以在游戏运行时进行修改：

![image-20200525140707593](../images/image-20200525140707593.png)

## 5 材质参数集

### 5.1 创建

![image-20200525140801598](../images/image-20200525140801598.png)

### 5.2 定义参数

![image-20200525141025439](../images/image-20200525141025439.png)

### 5.3 使用

将参数集拖到材质中，然后修改属性，即可。



## 6 材质应用

### 6.1 用材质表示物体的状态

在游戏中，对于数量较多的小怪，我们使用血条会导致屏幕上都是红色的条条，很不美观，那我们如何来表示敌方小怪的生命状态呢？

我们可以使用材质，在怪物满血的时候使用原始材质，而在怪物濒死的时候，让怪物的材质变灰或者变红。我们需要经过如下的操作：

* 首先创建一个材质，将一个参数暴露出去：

![image-20200525145949516](../images/image-20200525145949516.png)

* 动态给模型设置材质

  ![image-20200525150119089](../images/image-20200525150119089.png)

  其中的`HPPercent`是暴露的参数，设置的时候，需要指定参数的名称。

然后修改 HP 的时候，动态的调整材质参数即可。



## 7 场景实时监控

### 7.1 添加场景捕捉摄像机

![image-20200525151308133](../images/image-20200525151308133.png)

 驾驶摄像机来调整位置：

![image-20200525151441408](../images/image-20200525151441408.png)



### 7.2 创建2D画板

![image-20200525151539764](../images/image-20200525151539764.png)



### 7.3 将 2D 画板和摄像机绑定

![image-20200525151825009](../images/image-20200525151825009.png)



### 7.4 预览

![image-20200525152012901](../images/image-20200525152012901.png)



### 7.5 创建一个片模型

![image-20200525152221951](../images/image-20200525152221951.png)

调整好大小，让它和2D画板的 SizeX 和 SizeY 等比例。

### 7.6 将 2D画板拖到片模型上

![image-20200525152611434](../images/image-20200525152611434.png)

此时系统会自动的创建一个材质：

![image-20200525152651464](../images/image-20200525152651464.png)



![image-20200525152747525](../images/image-20200525152747525.png)



### 7.7 点击 Play 可以预览

![image-20200525152853259](../images/image-20200525152853259.png)



### 7.8 实际应用

可以将摄像头摆在人的面前，这样可以制作一个镜子。



## 8 动态材质应用——将上面实时监控使用 Actor 来创建

### 8.1 在蓝图中添加一个捕获摄像机

![image-20200525161741899](../images/image-20200525161741899.png)

并和 2D 绘版绑定：

![image-20200525171951614](../images/image-20200525171951614.png)

然后在关卡中随意的摆放上面两个 Actor.

### 8.2 将第7节的材质的参数暴露出来

使用参数`view` 将材质暴露出去，也可以使用 `textureSampParameter2D` 来创建材质贴图。

![image-20200525172428741](../images/image-20200525172428741.png)

### 8.3 创建动态材质并和片模型绑定

![image-20200525172637593](../images/image-20200525172637593.png)

### 8.4 更新材质参数

![image-20200525172906545](../images/image-20200525172906545.png)



### 8.5 动态材质参数设置类型

![image-20200525173347717](../images/image-20200525173347717.png)